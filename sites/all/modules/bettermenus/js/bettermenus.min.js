// $Id: bettermenus.min.js,v 1.1 2010/06/01 08:37:15 blixxxa Exp $
const BETTERMENUS_TREE_BEFORE=1;const BETTERMENUS_TREE_AFTER=2;const BETTERMENUS_TREE_FIRST=3;Drupal.behaviors.bettermenus=function(context){bettermenus_init();if(Drupal.settings.bettermenus.selected){$("#edit-menu-tree-add-new").attr("disabled","disabled")}$("#edit-menu-tree-add-new").bind("click",bettermenus_add_node);$("#edit-menu-tree-rename").bind("click",bettermenus_rename_node);$("#edit-menu-tree-delete").bind("click",bettermenus_remove_node);$("#node-form").submit(function(){})};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};function bettermenus_init(){$("#menu-tree-wrapper").tree({ui:{theme_name:"classic"},types:{"default":{deletable:false,draggable:false,renameable:false},current:{deletable:true,draggable:true,renameable:true,icon:{image:Drupal.settings.basePath+Drupal.settings.bettermenus.path+"/images/icons.png"}}},callback:{oncreate:bettermenus_set_parent,onmove:bettermenus_set_parent,onselect:bettermenus_select_node,onrename:function(node,tree,rollback){$("#edit-menu-link-title").val($(node).text().trim())},check_move:function(node,ref,type,tree){if($(ref).parent().attr("rel")=="default"){return true}else{return false}}},selected:Drupal.settings.bettermenus.selected})}function bettermenus_set_parent(node,ref,type,tree,rollback){var parent=tree.parent(node);var parts;if(parent==-1){parts=["primary-links","0","0"]}else{parts=parent[0].id.split("_")}$("#edit-menu-parent").val(parts[0]+":"+parts[1]);var weight=bettermenus_get_weight(node,tree);$("#edit-menu-weight").val(weight)}function bettermenus_get_weight(node,tree){var position=BETTERMENUS_TREE_BEFORE;var sibling=tree.prev(node,true);if(sibling==false){position=BETTERMENUS_TREE_AFTER;sibling=tree.next(node,true)}if(sibling==false){position=BETTERMENUS_TREE_FIRST}var weight=0;switch(position){case BETTERMENUS_TREE_FIRST:weight=0;break;case BETTERMENUS_TREE_BEFORE:parts=sibling[0].id.split("_");weight=parseFloat(parts[2])+1;break;case BETTERMENUS_TREE_AFTER:parts=sibling[0].id.split("_");weight=parseFloat(parts[2])-1;break}return weight}function bettermenus_select_node(node,tree){if(node.attributes.rel.value=="current"){$("#edit-menu-tree-delete, #edit-menu-tree-rename").attr("disabled","")}else{var val=node.attributes.id.value.split("_");$("#edit-menu-tree-delete, #edit-menu-tree-rename").attr("disabled","disabled")}return false}function bettermenus_add_node(){var tree=$.tree.focused();if(tree.selected){var node=tree.create({attributes:{rel:"current"}},tree.selected,"after")}$(this).attr("disabled","disabled");$("#edit-menu-delete").attr("checked","");return false}function bettermenus_rename_node(){var tree=$.tree.focused();tree.rename();return false}function bettermenus_remove_node(){var tree=$.tree.focused();tree.remove();$("#edit-menu-tree-add-new").attr("disabled","");$("#edit-menu-delete").attr("checked","checked");return false};